<?xml version='1.0' encoding='UTF-8'?>

<tool id="nmr-integrals" name="Compare Bruker NMR/metabolites " version="1.0">
  <description>Compare specific metabolite levels in two NMR spectra</description>
  <command detect_errors="exit_code"><![CDATA[
    #if $signal_metabolites:
      integrals_galaxy_wrapper.sh "\${PWD}" ${left} ${right} ${where} "${output_plotfile}" "${reference_spec}" "${test_spec}" "${output_table}" "${signal_metabolites}"
    #else
      integrals_galaxy_wrapper.sh "\${PWD}" ${left} ${right} ${where} "${output_plotfile}" "${reference_spec}" "${test_spec}" "${output_table}"
    #end if
    ]]>
  </command>
  <inputs>
    <param name="left" type="float" value="5.257" label="Left" help="Left (e.g., 5.257)"/>
    <param name="right" type="float" value="5.225" label="Right" help="Right (e.g., 5.225)"/>
    <param name="where" type="float" value="5.243" label="Where" help="Where (e.g., 5.243)"/>
    <param name="reference_spec" type="data" format="no_unzip.zip" label="Reference" help="Reference spectrum (zipped Bruker NMR dataset)"/>
    <param name="test_spec" type="data" format="no_unzip.zip" label="Test" help="Test spectrum (zipped Bruker NMR dataset)"/>
    <param name="signal_metabolites" type="data" format="tsv" label="Signal Metabolites" optional="true"
        help="Table of signal metabolites to be used to compare the two spectra (optional)."/>
  </inputs>
  <outputs>
    <data format="pdf" name="output_plotfile" label="Metabolite plots" />
    <data format="tsv" name="output_table" label="Comparison table" />
  </outputs>
  <stdio>
    <exit_code range="1:" level="fatal"/>
  </stdio>

  <help>

===================
NMR-integrals
===================

---------------------
Short Description
---------------------

Compares specific metabolite levels in two NMR spectra.

---------------
Description
---------------

This tool implements a comparison between the NMR spectra of a reference sample
and a test sample, based on selected metabolite signals.  The operation is part
of the QC procedure implemented in a number of biobanks, where samples are
periodically analyzed to detected and measure long-term quality decay.


The tool generates a table and a set of plots indicating the signal differences
and whether they are significant.
  </help>

</tool>
